.test:cargo:
  stage: test
  script:
    - apt update
    - apt install -y libzfslinux-dev
    #- apt install -y llvm-dev libclang-dev clang
    - bash -c "$(wget -O - https://apt.llvm.org/llvm.sh)"
    - cargo fmt -- --check
    - cargo clippy --all-targets
    - cargo test

stages:
  - test

stable:test:
  extends: .test:cargo
  image: rustdocker/rust:stable

beta:test:
  extends: .test:cargo
  image: rustdocker/rust:beta

nightly:test:
  extends: .test:cargo
  image: rustdocker/rust:nightly
